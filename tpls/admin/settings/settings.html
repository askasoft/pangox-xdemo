{{MapSet .Ctx.Attrs "astyles" (Array "admin/settings.css")}}
{{MapSet .Ctx.Attrs "ascripts" (Array "admin/settings.js")}}

{{template "main_header" .}}

<div class="s-section">
	<div class="s-section-head">
		<h2>{{I "admin.settings"}}<span>{{T .Loc "menu.admin.settings"}}</span></h2>
		<div class="ms-auto"></div>
		<button class="btn btn-sm btn-outline-primary" popup-target="#settings_import_popup">
			{{I "upload"}} {{T .Loc "button.import"}}
		</button>
		<button class="btn btn-sm btn-outline-primary" id="settings_export">
			{{I "dnload"}} {{T .Loc "button.export"}}
		</button>
	</div>
	<div class="s-section-body">
		{{if gt (len .Settings) 1}}
		<ul class="nav nav-tabs sc-nav">
			{{range $i, $sc := .Settings}}
			<li id="sch_{{$sc.Name}}" class="nav-item">
				<a class="nav-link{{if eq $i 0}} active{{end}}" href="#sc_{{$sc.Name}}" data-bs-toggle="tab">{{T $.Loc (print "setting.category.label." $sc.Name)}}</a>
			</li>
			{{end}}
		</ul>
		{{end}}

		<div class="tab-content">
			{{range $i, $sc := .Settings}}
			<div id="sc_{{$sc.Name}}" class="tab-pane{{if eq $i 0}} active{{end}}"><div class="scc">
				<ul class="nav nav-pills">
					{{range $j, $sg := $sc.Groups}}
					<li id="sgh_{{$sg.Name}}" class="nav-item">
						<a class="nav-link{{if eq $j 0}} active{{end}}" href="#sg_{{$sg.Name}}" data-bs-toggle="tab">{{T $.Loc (print "setting.group.label." $sg.Name)}}</a>
					</li>
					{{end}}
				</ul>

				<div class="tab-content">
					{{range $j, $sg := $sc.Groups}}
					<div id="sg_{{$sg.Name}}" class="tab-pane{{if eq $j 0}} active{{end}}">
						{{$sgw := (T $.Loc (print "setting.group.well." $sg.Name))}}
						{{if $sgw}}
						<div class="well"><div class="offset-md-2 col">{{HTML $sgw}}</div></div>
						{{end}}

						<form class="stgform ui-form lined grey padded rounded" method="POST" autocomplete="off">
							{{$aro := true}}
							{{range $s := $sg.Items}}
								{{$ro := ($s.Readonly $.AU.Role)}}
								{{if not $ro}}{{$aro = false}}{{end}}
							<div class="row">
								<label class="col-md-2 col-form-label{{if $s.Required}} required{{end}}"
									viewer="{{$s.Viewer}}" editor="{{$s.Editor}}">{{T $.Loc (print "setting." $s.Name)}}</label>
								<div class="col-md-10">
								{{if eq $s.Style "H"}}
									<input name="{{$s.Name}}" type="hidden" value="{{$s.DisplayValue}}"{{if $ro}} disabled{{end}}/>
								{{else if eq $s.Style "C"}}
									<input type="checkbox" name="{{$s.Name}}" value="" checked{{if $ro}} disabled{{end}} style="display:none">
									{{Checks "Name=" $s.Name "List=" (MapGet $.Lists $s.Name) "Values=" $s.Values "Disabled=" $ro}}
								{{else if eq $s.Style "CV"}}
									<input type="checkbox" name="{{$s.Name}}" value="" checked{{if $ro}} disabled{{end}} style="display:none">
									{{Checks "Name=" $s.Name "List=" (MapGet $.Lists $s.Name) "Values=" $s.Values "Disabled=" $ro "class=" "vertical"}}
								{{else if eq $s.Style "CO"}}
									<input type="checkbox" name="{{$s.Name}}" value="" checked{{if $ro}} disabled{{end}} style="display:none">
									{{Checks "Name=" $s.Name "List=" (MapGet $.Lists $s.Name) "Values=" $s.Values "Disabled=" $ro "Ordered=" true}}
								{{else if eq $s.Style "COV"}}
									<input type="checkbox" name="{{$s.Name}}" value="" checked{{if $ro}} disabled{{end}} style="display:none">
									{{Checks "Name=" $s.Name "List=" (MapGet $.Lists $s.Name) "Values=" $s.Values "Disabled=" $ro "Ordered=" true "class=" "vertical"}}
								{{else if eq $s.Style "R"}}
									{{Radios "Name=" $s.Name "List=" (MapGet $.Lists $s.Name) "Value=" $s.Value "Disabled=" $ro}}
								{{else if eq $s.Style "RV"}}
									{{Radios "Name=" $s.Name "List=" (MapGet $.Lists $s.Name) "Value=" $s.Value "Disabled=" $ro "class=" "vertical"}}
								{{else if eq $s.Style "S"}}
									{{Select "Name=" $s.Name "List=" (MapGet $.Lists $s.Name) "Value=" $s.Value "Disabled=" $ro "data-spy=" "niceSelect" "class=" "wide"}}
								{{else if eq $s.Style "SM"}}
									{{Select "Name=" $s.Name "List=" (MapGet $.Lists $s.Name) "Multiple=" true "Values=" $s.Values "Disabled=" $ro "data-spy=" "niceSelect" "class=" "wide"}}
								{{else if eq $s.Style "T"}}
									<textarea name="{{$s.Name}}" class="form-control" rows="2" placeholder="{{T $.Loc (print "setting.placeholder." $s.Name)}}" textclear enterfire{{if $ro}} disabled{{end}}>
{{$s.DisplayValue}}</textarea>
								{{else if eq $s.Style "N"}}
									<input name="{{$s.Name}}" type="text" size="20" class="form-control" textclear value="{{$s.DisplayValue}}"{{if $ro}} disabled{{end}}/>
								{{else if eq $s.Style "D"}}
									<input name="{{$s.Name}}" type="text" size="20" class="form-control" textclear value="{{$s.DisplayValue}}"{{if $ro}} disabled{{end}}/>
								{{else if eq $s.Style "TD"}}
									<input name="{{$s.Name}}" type="date" class="form-control" textclear value="{{$s.DisplayValue}}"{{if $ro}} disabled{{end}}/>
								{{else if eq $s.Style "TT"}}
									<input name="{{$s.Name}}" type="time" class="form-control" textclear value="{{$s.DisplayValue}}"{{if $ro}} disabled{{end}}/>
								{{else if eq $s.Style "TM"}}
									<input name="{{$s.Name}}" type="month" class="form-control" textclear value="{{$s.DisplayValue}}"{{if $ro}} disabled{{end}}/>
								{{else if eq $s.Style "F"}}
									<div data-spy="uploader" data-upload-name="file" data-upload-url="./files/upload" data-dnload-url="./files/preview$" data-value="{{$s.Value}}">
										<input type="hidden" name="{{$s.Name}}" class="ui-uploader-empty" value=""/>
										<input type="file" name="{{$s.Name}}" class="ui-uploader-file" style="display:none"/>
										<a class="btn btn-sm btn-primary ui-uploader-btn">{{T $.Loc "button.browse"}}</a>
									</div>
								{{else if eq $s.Style "FS"}}
									<div data-spy="uploader" data-upload-name="file" data-upload-url="./files/upload" data-dnload-url="./files/preview$" data-values="{{JSON $s.Values}}">
										<input type="hidden" name="{{$s.Name}}" class="ui-uploader-empty" value=""/>
										<input type="file" name="{{$s.Name}}" multiple class="ui-uploader-file" style="display:none"/>
										<a class="btn btn-sm btn-primary ui-uploader-btn">{{T $.Loc "button.browse"}}</a>
									</div>
								{{else}}
									<input name="{{$s.Name}}" type="text" class="form-control" textclear textstrip value="{{$s.DisplayValue}}" placeholder="{{T $.Loc (print "setting.placeholder." $s.Name)}}"{{if $ro}} disabled{{end}}/>
								{{end}}
								{{$desc := (T $.Loc (print "setting.desc." $s.Name))}}
								{{if $desc}}
									<div class="desc">{{HTML $desc}}</div>
								{{end}}
								</div>
							</div>
							{{end}}
							{{if not $aro}}
							<div class="row">
								<div class="offset-md-2 col">
									<button class="btn btn-primary">{{I "save"}} {{T $.Loc "button.save"}}</button>
								</div>
							</div>
							{{end}}
						</form>
					</div>
					{{end}}
				</div>
			</div></div>
			{{end}}
		</div>
	</div>
</div>

<div id="settings_import_popup" class="ui-popup s-popup-detail" data-spy="popup" tabindex="-1"
	popup-position="center" popup-mask="true" popup-scroll="false" popup-mouse="false" popup-closer="true">
	<div class="ui-popup-header">
		<h4><span>{{I "upload"}} {{T .Loc "setting.import.head"}}</span></h4>
	</div>
	<div class="ui-popup-body grey">
		<form class="ui-form lined" autocomplete="off">
			<div class="row">
				<label class="col-md-3 col-form-label">{{T .Loc "setting.import.file"}}</label>
				<div class="col-md-9">
					<input type="file" name="file" accept=".csv" class="form-control">
				</div>
			</div>
			<button type="submit" class="hidden"></button>
		</form>
	</div>
	<div class="ui-popup-footer">
		<button type="submit" class="btn btn-primary">{{I "upload"}} {{T .Loc "button.import"}}</button>
		<button type="button" class="btn btn-secondary" popup-dismiss="true">{{I "cancel"}} {{T .Loc "button.cancel"}}</button>
	</div>
</div>

{{template "main_footer" .}}